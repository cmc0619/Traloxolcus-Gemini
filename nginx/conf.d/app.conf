server {
    listen 80;
    server_name localhost; 
    # In prod, this would be your domain, e.g., soccer.example.com

    location /.well-known/acme-challenge/ {
        root /var/www/certbot;
    }

    location / {
        return 301 https://$host$request_uri;
    }
}

server {
    listen 443 ssl;
    server_name localhost;

    # SSL Config - Dummy certs for localhost or mapped volumes for real ones
    # For now, we use self-signed or assume certs exist.
    # If Certbot is used, paths will be:
    # ssl_certificate /etc/letsencrypt/live/example.com/fullchain.pem;
    # ssl_certificate_key /etc/letsencrypt/live/example.com/privkey.pem;
    
    # Since we don't have a domain yet, let's output a self-signed config or comment out strict SSL
    # and wait for user to provide domain. 
    # USER REQUEST: "Use LetsEncrypt... We'll be SSL only now"
    # To use LetsEncrypt, we NEED a domain. 
    # I will configure it for a placeholder 'example.com' and comment it 
    # so user knows where to edit.
    
    # ssl_certificate /etc/letsencrypt/live/example.com/fullchain.pem;
    # ssl_certificate_key /etc/letsencrypt/live/example.com/privkey.pem;
    
    # FOR LOCALHOST DEV (Self-Signed fallback approach for testing)
    # We will generate a self-signed cert in the entrypoint or just disable SSL directive if files missing? Nginx fails if missing.
    # safer: Just proxy pass for now to 8000 but listen on 443? No, browser needs cert on 443.
    
    # BETTER PLAN: Since I cannot interactively run Certbot for them without a DNS name,
    # and they said "Use LetsEncrypt", I will set up the container structure.
    # BUT I cannot start Nginx with missing cert files. 
    # I will generate a dummy self-signed cert for "localhost" to allow startup.

    ssl_certificate /etc/nginx/ssl/live/selfsigned.crt;
    ssl_certificate_key /etc/nginx/ssl/live/selfsigned.key;

    location / {
        proxy_pass http://platform:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
